# 灵犀指标平台V0.2.md

## 1. 引言

### 1.1. 目的
本文档阐述了灵犀指标平台的产品需求。灵犀旨在成为一个集中、统一、智能的平台，用于定义、管理、追踪、可视化和分析关键业务指标，通过可行的洞察赋能团队，以驱动数据驱动的决策。

### 1.2. 背景
目前，指标的定义和追踪分散在各个系统和文档中（如提供的图片所示），这可能导致定义不一致、难以获取最新信息以及缺乏单一事实来源。灵犀将解决这些挑战。

### 1.3. 范围
*   **一期范围 (In Scope - Phase 1)：**
    *   基于提供的列表及未来新增指标的集中化指标定义与管理。
    *   用于计算这些指标的数据接入能力。
    *   关键指标的仪表盘创建与可视化。
    *   基础数据探索（筛选、细分）。
    *   用户和角色管理。
    *   关键指标阈值的预警功能。
*   **非一期范围 (Out of Scope - Phase 1)：**
    *   高级统计分析（例如，预测建模、超出简单阈值的异常检测）。
    *   A/B 测试框架集成。
    *   自然语言查询 (NLQ)。
    *   ETL流程创建工具（灵犀将消费已处理的数据或在数据仓库之上定义计算）。

## 2. 目标

### 2.1. 业务目标
*   通过提供及时准确的指标，提高决策速度和质量。
*   通过自动化指标报告和分析，提升运营效率。
*   在组织内培养数据驱动的文化。
*   通过为所有关键指标建立单一事实来源，减少模糊性。

### 2.2. 产品目标
*   **统一性：** 对所有关键业务指标（从提供的列表开始）提供全公司统一的理解。
*   **易用性/可访问性：** 使相关利益相关者能以用户友好的方式轻松访问指标。
*   **准确性：** 确保指标计算和呈现中的数据准确性和一致性。
*   **可操作性：** 使用户能够从指标中获得可操作的洞察。
*   **可扩展性：** 平台设计应能处理不断增长的数据量以及越来越多的指标和用户。

## 3. 目标用户与画像

### 3.1. 业务分析师 / 数据分析师
*   **需求：** 定义、验证和管理指标。执行深度分析。创建复杂的报告和仪表盘。监控数据质量。
*   **痛点：** 数据源分散，定义不一致，手动生成报告。

### 3.2. 产品经理
*   **需求：** 追踪产品性能KPI（例如，新增签约数、KQ券占率、新车纯发放金额占比）。理解用户行为。衡量新功能的影响。
*   **痛点：** 难以快速获取其领域相关的指标。

### 3.3. 运营团队
*   **需求：** 监控运营指标（例如，发放金额、充值金额、达产门店数）。快速识别并应对运营问题。
*   **痛点：** 报告延迟，缺乏实时预警。

### 3.4. 市场团队
*   **需求：** 追踪营销活动效果，客户获取指标（例如，活动发放金额）。
*   **痛点：** 难以将营销支出与成果归因。

### 3.5. 管理层 / 高管
*   **需求：** 通过关键仪表盘对业务健康状况进行高层概览。追踪战略目标的进展。
*   **痛点：** 报告通常是静态的，缺乏交互性。

## 4. 用户故事

### 指标定义与管理
*   **US1:** 作为一名数据分析师，我希望能将提供的电子表格中的所有指标（指标名称、指标类别、业务定义、产品梳理统计口径）录入并管理到灵犀平台，以便我们拥有一个集中的、版本受控的指标库。
*   **US2:** 作为一名数据治理员，我希望为每个指标定义负责人和更新频率，以便明确责任。
*   **US3:** 作为一名数据分析师，我希望在平台内定义每个指标的计算逻辑（例如SQL查询、公式），使其透明且可复现。
*   **US4:** 作为一名产品经理，我希望能轻松搜索和浏览可用的指标及其清晰的业务定义和计算逻辑，以便我理解它们代表的含义。

### 数据可视化与仪表盘
*   **US5:** 作为一名产品经理，我希望能创建一个自定义仪表盘，显示“充值金额”、“发放金额”和“纯发放金额”随时间变化的趋势，以便监控核心交易量。
*   **US6:** 作为一名运营经理，我希望在实时仪表盘上看到“商户当前账户总余额”和“连续三个月未活跃商户数”，以便监控商户健康状况。
*   **US7:** 作为一名管理者，我希望查看一个总结关键指标（如“新增签约数”、“KQ券占率”和“Kz 签充率”）的仪表盘，并可以按周期（日、周、月、季）筛选，以便评估整体业务增长。
*   **US8:** 作为一名用户，我希望能与团队其他成员共享我的仪表盘，或将其设置为组织内部公开可见。

### 数据探索与分析
*   **US9:** 作为一名业务分析师，我希望能按“指标类别”（例如，新车、续保、事故车）筛选“发放金额”并比较其表现，以便了解哪些业务线在驱动发放。
*   **US10:** 作为一名产品经理，我希望能下钻到“当月新签充值门店数”以查看实际的门店列表，以便进一步调查。
*   **US11:** 作为一名用户，我希望能将图表数据或表格导出为CSV/Excel格式进行离线分析。

### 预警
*   **US12:** 作为一名运营经理，我希望设置预警，当“发放撤回金额”在一天内超过某个阈值时收到通知，以便调查潜在问题。
*   **US13:** 作为一名产品经理，我希望当某个月的“权益过期总金额”异常高时收到通知，以便评估用户对权益的参与度。

### 用户管理
*   **US14:** 作为一名管理员，我希望创建用户角色（例如，管理员、编辑者、查看者）并分配访问指标、仪表盘和平台功能的权限。

## 5. 功能需求

### 5.1. 指标中心 (Metrics Hub / Catalog)

#### 5.1.1. 指标定义
每个指标的字段：
*   `指标ID` (系统生成，唯一)
*   `指标名称` (例如，“充值金额” - 文本，可搜索)
*   `指标英文名` (系统使用，例如，`recharge_amount` - 文本，唯一)
*   `指标类别` (例如，“充值相关”，“发放相关” - 从预定义列表选择，可扩展。使用提供图片中的类别作为初始值)
*   `业务定义` (富文本，用于详细解释)
*   `产品梳理统计口径/计算逻辑` (富文本，可包含伪代码或链接到SQL定义)
*   `计算公式/查询语句` (若在灵犀内定义，则为实际的SQL或公式)
*   `数据源` (链接到底层数据表或源系统)
*   `数据类型` (例如，货币，百分比，计数，比率)
*   `更新频率` (例如，实时，每小时，每日，每周，每月)
*   `负责人/Owner` (系统中的用户ID)
*   `创建者` (用户ID)
*   `创建时间` (时间戳)
*   `最后修改者` (用户ID)
*   `最后修改时间` (时间戳)
*   `版本号` (整数，用于追踪定义的变更)
*   `状态` (例如，活跃，已弃用，开发中)
*   `标签/Tags` (用于更好的搜索性和分组)
*   `相关维度` (该指标可进行切片的维度列表，例如，时间，门店，产品类别)

#### 5.1.2. 指标生命周期管理
创建、读取、更新、删除（软删除/弃用）指标。指标定义的版本历史。

#### 5.1.3. 指标搜索与发现
按名称、类别、标签、定义搜索。按负责人、状态、更新频率筛选。

#### 5.1.4. 指标血缘 (未来增强)
指标如何从原始数据或其他指标派生出来的可视化表示。

#### 5.1.5. 数据质量规则（基础）
能够为指标值设置基础验证规则（例如，非空，在范围内）。

### 5.2. 数据接入与计算 (Data Ingestion & Calculation)

#### 5.2.1. 数据源连接器
能够连接到常见的数据仓库（例如，MySQL, PostgreSQL, ClickHouse, Hive, BigQuery），其中存储原始或预聚合数据。

#### 5.2.2. 指标计算引擎
*   选项1：从数据仓库获取预计算的指标。
*   选项2：在灵犀内定义SQL查询，以按需或按计划针对连接的数据源计算指标。
*   支持指标的计划刷新。

#### 5.2.3. 参数化查询
在指标计算中支持日期参数（例如，T-1, 最近7天, 月初至今）。

### 5.3. 数据可视化与看板 (Data Visualization & Dashboards)

#### 5.3.1. 图表类型
支持常见的图表类型：
*   折线图 (用于趋势，例如，`充值金额`随时间变化)
*   柱状图 (用于比较，例如，`新车纯发放金额` vs `续保纯发放金额`)
*   饼图/环形图 (用于占比，例如，`新车纯发放金额占比`)
*   指标卡/KPI卡 (用于单个重要数字，例如，`商户当前账户总余额`)
*   表格 (用于详细数据显示，例如，`连续三个月未活跃商户数`列表)

#### 5.3.2. 仪表盘创建
*   拖拽式界面添加/排列图表。
*   可自定义布局。
*   能够添加文本小部件用于标题、解释。

#### 5.3.3. 交互性
*   仪表盘级别筛选器（例如，日期范围，区域，产品类别）。
*   图表的下钻功能（如果底层数据支持）。
*   数据点悬停提示。

#### 5.3.4. 仪表盘管理
保存、编辑、共享（给特定用户/角色或组织内公开链接）、克隆、删除仪表盘。将仪表盘组织到文件夹中。

### 5.4. 数据分析与探索 (Data Analysis & Exploration)

#### 5.4.1. 即席查询（简化版）
一个用户界面，用于选择指标、维度、筛选器和时间范围以生成自定义视图，无需编写SQL。

#### 5.4.2. 细分
能够按可用维度对指标进行细分（例如，“发放金额”按“门店类型”）。

#### 5.4.3. 数据导出
将图表数据和表格视图导出为CSV或Excel。

### 5.5. 预警与通知 (Alerting & Notifications)

#### 5.5.1. 预警配置
用户可以为特定指标设置预警。
*   条件：例如，`如果 发放撤回金额 > X 持续 Y 周期`，`如果 Kz 签充率 < Z%`。
*   阈值类型：静态值，与上一周期的百分比变化。
*   检查频率。

#### 5.5.2. 通知渠道
电子邮件，应用内通知。（未来：钉钉/企业微信，Webhooks）。

#### 5.5.3. 预警管理
查看活动预警，已触发预警的历史记录。

### 5.6. 用户与权限管理 (User & Permission Management)

#### 5.6.1. 用户认证
与现有SSO或内部用户目录集成。

#### 5.6.2. 基于角色的访问控制 (RBAC)
*   预定义角色：管理员，编辑者（可以创建/编辑指标和仪表盘），查看者（只能查看）。
*   权限：对谁可以定义指标、创建/编辑仪表盘、查看特定指标/仪表盘进行细粒度控制。

#### 5.6.3. 用户组
能够创建用户组以便于权限管理。

### 5.7. 系统管理 (System Administration)

#### 5.7.1. 数据源管理
添加、编辑、测试到数据源的连接。

#### 5.7.2. 审计日志
追踪关键用户操作（指标定义更改，仪表盘创建/删除，权限更改）。

#### 5.7.3. 平台健康监控
系统性能和作业状态的基础监控。

## 6. 非功能需求

### 6.1. 性能
*   仪表盘加载时间：对于包含多达10个小部件的典型仪表盘，< 5秒。
*   指标查询响应时间：数据加载/缓存后，对于大多数常见查询 < 3秒。

### 6.2. 可扩展性
*   初期能够处理多达1,000个已定义指标。
*   支持100+并发用户。
*   处理与中型企业相对应的数据量（具体细节将根据基础设施定义）。

### 6.3. 可靠性与可用性
*   目标可用性：99.9%。
*   数据备份和恢复机制。

### 6.4. 易用性
*   直观且用户友好的界面，查看者和仪表盘创建者仅需最少培训。
*   整个平台一致的设计语言。
*   针对常见桌面分辨率的响应式设计。

### 6.5. 安全性
*   数据源凭证的安全存储。
*   防范常见的Web漏洞（如XSS、SQL注入等，如适用）。
*   传输中数据加密 (HTTPS) 和静态数据加密（可选，取决于数据敏感性）。

### 6.6. 可维护性
*   模块化架构，以便于更新和添加新功能。
*   良好文档化的代码和API。

### 6.7. 可扩展性 (Extensibility)
*   用于程序化访问指标和定义的API（未来增强）。
*   未来能够添加新的图表类型和数据源连接器。

## 7. 数据模型 (概念性 - 基于提供的指标)

### 关键实体 (用于指标计算)
*   `商户 (Merchants)`: ID, 名称, 签约日期, 类型, 状态等。
*   `C端用户 (Users_C_End)`: ID, 注册日期等。
*   `账户 (Accounts)`: 商户ID, 账户类型 (充值户, 奖励户), 余额。
*   `交易 (Transactions)`: 交易ID, 类型 (充值, 发放, 提现, 退款), 金额, 商户ID, C端用户ID, 时间戳, 关联订单ID, 产品类型 (新车, 续保, 事故车, 活动, 其他商品下单), 券类型 (通用券, 京东E卡, 充电券)。
*   `签约 (Contracts)`: 签约ID, 商户ID, 签约日期, 合同条款。
*   `门店 (Stores)`: 门店ID, 商户ID, 位置, 活跃状态。
*   `权益物 (Benefit_Items)`: 物品ID, 名称, 类型 (通用券, 京东E卡, 充电券), 发放日期, 过期日期, 状态 (已发放, 已兑换, 已过期)。

### 指标存储
*   一个表或系统，用于存储随时间变化的、带维度的计算指标值。
*   例如：`指标值表 (指标ID, 日期, 维度1值, 维度2值, ..., 指标值)`

## 8. 未来规划 / 路线图 (一期后)

*   高级分析：同期群分析，漏斗分析，异常检测。
*   指标血缘和影响分析。
*   A/B 测试集成和结果可视化。
*   自然语言查询 (NLQ) 进行数据探索。
*   基于机器学习的指标预测。
*   增强的协作功能（仪表盘评论，注释）。
*   移动应用 / 移动端响应式网页。
*   供外部系统消费指标数据的API。
*   数据质量管理模块。

## 9. 待确认问题与假设

*   现有数据仓库/数据湖的技术栈是什么？
*   关键表（交易、用户、商户）的预期数据量是多少？
*   现有的身份和访问管理系统（用于SSO）是什么？
*   **假设：** 计算所有提供指标所需的原始数据是可用的，并且以结构化格式可访问。
*   **假设：** 图片中提供的业务定义和统计口径是准确的，并已获得利益相关者的同意。
*   指标数据的具体数据保留策略是什么？
*   “duiy”（在“发放撤回金额”下提到）的具体需求是什么？
*   如果需要更具体的业务背景以便于平台设计决策，请阐明“KQ券”和“Kz 签充率”的含义。（尽管有定义，但具体的行为或业务重要性可能会影响UI/UX的优先级）。